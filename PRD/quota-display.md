# PRD: ç½‘é¡µç«¯æ˜¾ç¤º Antigravity Quota é…é¢ä¿¡æ¯

## èƒŒæ™¯

Antigravity IDE å®‰è£…äº† [Quota Watcher](https://github.com/wusimpl/AntigravityQuotaWatcher) æ’ä»¶ï¼Œåœ¨çŠ¶æ€æ å®æ—¶æ˜¾ç¤ºå„ AI æ¨¡å‹çš„é…é¢å‰©ä½™æƒ…å†µï¼ˆå¦‚ `ğŸŸ¢ Claude: 100%`ï¼‰ã€‚å½“å‰ Shit-Chat ç½‘é¡µç«¯æ— æ³•çœ‹åˆ°è¿™äº›ä¿¡æ¯ï¼Œç”¨æˆ·éœ€è¦åˆ‡å› IDE æ‰èƒ½æŸ¥çœ‹é¢åº¦ã€‚

**ç›®æ ‡**ï¼šåœ¨ Shit-Chat ç½‘é¡µç«¯å®æ—¶æ˜¾ç¤ºé…é¢ä¿¡æ¯ï¼Œè®©ç”¨æˆ·éšæ—¶äº†è§£æ¨¡å‹ä½¿ç”¨æƒ…å†µã€‚

---

## æŠ€æœ¯éªŒè¯ç»“æœ

é€šè¿‡ `test-quota.js` éªŒè¯ï¼Œå¯ä»¥é€šè¿‡ CDP ä» Antigravity IDE çŠ¶æ€æ çš„ DOM ä¸­æå–é…é¢æ•°æ®ï¼š

- **å…ƒç´ **: `#wusimpl.antigravity-quota-watcher`
- **æ•°æ®æ¥æº**: `aria-label` å±æ€§ï¼ŒåŒ…å« markdown æ ¼å¼çš„å®Œæ•´é…é¢è¡¨
- **å¯ç”¨äºä»»ä½• CDP context**ï¼ˆdefault æˆ– Electron Isolated Context å‡å¯ï¼‰
- **æ•°æ®æ ¼å¼** (aria-label å†…å®¹ç¤ºä¾‹)ï¼š

```
ğŸŸ¢  Claude: 100%, **Antigravity æ¨¡å‹é…é¢** (Google AI Pro)

| æ¨¡å‹ | å‰©ä½™ | é‡ç½®æ—¶é—´ |
| :--- | :--- | :--- |
|  Claude Opus 4.5 (Thinking) | 100.0% | 4h 43m from now |
|  Claude Sonnet 4.5 | 100.0% | 4h 43m from now |
|  Gemini 3 Flash | 100.0% | 4h 56m from now |
|  Gemini 3 Pro (High) | 100.0% | 4h 56m from now |
|  GPT-OSS 120B (Medium) | 100.0% | 4h 43m from now |
```

**è§£æåçš„ç»“æ„åŒ–æ•°æ®**ï¼š
```json
{
  "statusText": "ğŸŸ¢  Claude: 100%",
  "planName": "Google AI Pro",
  "models": [
    { "label": "Claude Opus 4.5 (Thinking)", "percentage": 100, "resetTime": "4h 43m from now" },
    { "label": "Gemini 3 Flash", "percentage": 100, "resetTime": "4h 56m from now" }
  ]
}
```

---

## å®ç°æ–¹æ¡ˆ

### 1. Server ç«¯ â€” `server.js`

#### æ–°å¢ `extractQuotaInfo(cdp)` å‡½æ•°

é€šè¿‡ CDP `Runtime.evaluate` æ‰§è¡Œ JS è„šæœ¬ï¼Œä»çŠ¶æ€æ  `aria-label` ä¸­æå–å¹¶è§£æé…é¢æ•°æ®ã€‚

```javascript
// æŸ¥æ‰¾ #wusimpl.antigravity-quota-watcher å…ƒç´ 
// è¯»å– aria-label å±æ€§
// è§£æ markdown è¡¨æ ¼ä¸º { statusText, planName, models[] }
```

#### ä¿®æ”¹ `updateSnapshots()` å¾ªç¯

åœ¨å¿«ç…§æ›´æ–°æ—¶åŒæ­¥è·å–é…é¢æ•°æ®ï¼Œç¼“å­˜åˆ° cascade å¯¹è±¡çš„ `quota` å±æ€§ä¸Šã€‚

#### æ–°å¢ WebSocket æ¶ˆæ¯ç±»å‹

- `quota_update` â€” å½“é…é¢å˜åŒ–æ—¶å¹¿æ’­åˆ°å‰ç«¯
- é…é¢æ•°æ®è·Ÿéš `cascade_list` ä¸€èµ·å‘é€ï¼Œå‡å°‘è¯·æ±‚æ•°

#### æ–°å¢ REST ç«¯ç‚¹

- `GET /api/quota/:id` â€” è·å–æŒ‡å®š cascade çš„é…é¢æ•°æ®ï¼ˆä¾›è½®è¯¢ä½¿ç”¨ï¼‰

---

### 2. Frontend ç«¯ â€” `public/index.html`

#### UI è®¾è®¡

åœ¨ headerï¼ˆtab æ ï¼‰ä¸‹æ–¹æ·»åŠ ä¸€ä¸ªç´§å‡‘çš„é…é¢æ˜¾ç¤ºæ¡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Tab1] [Tab2]                           [ï¼‹]   â”‚  â† ç°æœ‰ header
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š Pro  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 60%  Claude â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 40%  â–¼  â”‚  â† æ–°å¢é…é¢æ¡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚            (chat content)                      â”‚
â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è®¾è®¡è¦ç‚¹**ï¼š
- ç´§å‡‘å•è¡Œæ˜¾ç¤ºï¼Œå¯ç‚¹å‡»å±•å¼€æŸ¥çœ‹å…¨éƒ¨æ¨¡å‹è¯¦æƒ…
- è¿›åº¦æ¡ + ç™¾åˆ†æ¯” + é¢œè‰²æŒ‡ç¤ºï¼š
  - ğŸŸ¢ ç»¿è‰² (â‰¥50%) / ğŸŸ¡ é»„è‰² (30-50%) / ğŸ”´ çº¢è‰² (<30%) / âš« ç°è‰² (0%)
- å±•å¼€åæ˜¾ç¤ºæ‰€æœ‰æ¨¡å‹çš„å®Œæ•´åˆ—è¡¨ï¼ŒåŒ…å«é‡ç½®å€’è®¡æ—¶
- æ— é…é¢æ•°æ®æ—¶éšè—é…é¢æ¡ï¼ˆä¸å½±å“ç°æœ‰ UIï¼‰

#### WebSocket é›†æˆ

- ç›‘å¬ `quota_update` æ¶ˆæ¯å®æ—¶åˆ·æ–°æ˜¾ç¤º
- åˆ‡æ¢ cascade tab æ—¶ä»ç¼“å­˜åŠ è½½å¯¹åº”çš„é…é¢æ•°æ®

---

## æ³¨æ„äº‹é¡¹

> [!NOTE]
> é…é¢æ•°æ®éœ€è¦ Antigravity IDE å®‰è£… Quota Watcher æ’ä»¶ã€‚æœªå®‰è£…æ—¶é…é¢æ¡è‡ªåŠ¨éšè—ã€‚

> [!IMPORTANT]
> ä¸åŒ Antigravity çª—å£ï¼ˆcascadeï¼‰å¯èƒ½ç™»å½•ä¸åŒè´¦å·ï¼Œé…é¢æ•°æ®åº”æŒ‰ cascade åˆ†åˆ«å­˜å‚¨å’Œæ˜¾ç¤ºã€‚

---

## éªŒè¯æ–¹å¼

æ‰‹åŠ¨éªŒè¯ï¼š
1. å¯åŠ¨å¸¦ CDP çš„ Antigravity IDEï¼ˆè£…æœ‰ Quota Watcher æ’ä»¶ï¼‰
2. è¿è¡Œ `npm start`
3. ç¡®è®¤é…é¢æ¡æ˜¾ç¤ºï¼Œæ•°æ®ä¸ IDE çŠ¶æ€æ ä¸€è‡´
4. æ¶ˆè€—é…é¢åç¡®è®¤ç™¾åˆ†æ¯”å’Œé¢œè‰²æ›´æ–°
5. åˆ‡æ¢ cascade tab ç¡®è®¤é…é¢åˆ†åˆ«æ˜¾ç¤º
